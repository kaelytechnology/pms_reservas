# PMS Hotel Package

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![PHP Version](https://img.shields.io/badge/PHP-8.2%2B-blue.svg)](https://php.net)
[![Laravel Version](https://img.shields.io/badge/Laravel-12.0%2B-red.svg)](https://laravel.com)

Un paquete completo de Sistema de Gesti√≥n de Propiedades Hoteleras (PMS) para Laravel, desarrollado por Kaely Technology. Este paquete proporciona una soluci√≥n integral para la gesti√≥n de hoteles, incluyendo reservas, restaurantes, eventos y m√°s.

## üìö Documentaci√≥n

La documentaci√≥n completa est√° organizada en la carpeta `doc/` para facilitar la navegaci√≥n:

### üìñ Documentaci√≥n Principal
- [**√çndice de Documentaci√≥n**](./doc/README.md) - Navegaci√≥n completa
- [**Documentaci√≥n T√©cnica**](./doc/technical-documentation.md) - Instalaci√≥n, configuraci√≥n y arquitectura

### üè® M√≥dulos Principales
- [**Room Rate Rules**](./doc/room-rate-rules.md) - Reglas de tarifas por habitaci√≥n
- [**Reservations**](./doc/reservations.md) - Gesti√≥n de reservas principales
- [**Restaurant Reservations**](./doc/restaurant-reservations.md) - Reservas de restaurante
- [**Restaurants**](./doc/restaurants.md) - Gesti√≥n de restaurantes
- [**Foods**](./doc/foods.md) - Gesti√≥n de alimentos
- [**Food Types**](./doc/food-types.md) - Tipos de alimentos

### üçΩÔ∏è M√≥dulos Adicionales
- [**Otros M√≥dulos**](./doc/other-modules.md) - Beverages, Desserts, Events, Decorations, etc.

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#caracter√≠sticas)
- [Requisitos](#requisitos)
- [Instalaci√≥n](#instalaci√≥n)
- [Configuraci√≥n](#configuraci√≥n)
- [Uso](#uso)
- [M√≥dulos Disponibles](#m√≥dulos-disponibles)
- [API Endpoints](#api-endpoints)
- [Comandos Artisan](#comandos-artisan)
- [Modelos](#modelos)
- [Pol√≠ticas de Autorizaci√≥n](#pol√≠ticas-de-autorizaci√≥n)
- [Configuraci√≥n de Base de Datos](#configuraci√≥n-de-base-de-datos)
- [Integraci√≥n con Auth Package](#integraci√≥n-con-auth-package)
- [Contribuir](#contribuir)
- [Licencia](#licencia)

## ‚ú® Caracter√≠sticas

- **Gesti√≥n Completa de Hotel**: Manejo integral de todas las operaciones hoteleras
- **Sistema de Reservas**: Gesti√≥n avanzada de reservas de habitaciones y restaurantes
- **Gesti√≥n de Restaurantes**: Control completo de restaurantes, men√∫s y disponibilidad
- **Sistema de Eventos**: Organizaci√≥n y gesti√≥n de eventos especiales
- **Gesti√≥n de Tarifas**: Reglas flexibles para tarifas de habitaciones
- **API RESTful**: Endpoints completos para todas las funcionalidades
- **Autenticaci√≥n Integrada**: Compatible con Laravel Sanctum
- **Exportaci√≥n/Importaci√≥n**: Funcionalidades de exportar e importar datos
- **Sistema de Permisos**: Control granular de acceso por m√≥dulos
- **Multi-tenant**: Soporte para m√∫ltiples inquilinos

## üìã Requisitos

- PHP 8.2 o superior
- Laravel 12.0 o superior
- MySQL/PostgreSQL
- Composer
- `kaelytechnology/auth-package`

## üöÄ Instalaci√≥n

### 1. Instalar via Composer

```bash
composer require kaelytechnology/pms_hotel
```

### 2. Ejecutar el comando de instalaci√≥n

```bash
php artisan pms-hotel:install
```

Este comando publicar√°:
- Archivos de configuraci√≥n
- Migraciones de base de datos
- Seeders

### 3. Ejecutar las migraciones

```bash
php artisan migrate
```

### 4. (Opcional) Ejecutar los seeders

```bash
php artisan pms-hotel:seed
```

## ‚öôÔ∏è Configuraci√≥n

Despu√©s de la instalaci√≥n, el archivo de configuraci√≥n estar√° disponible en `config/pms-hotel.php`.

### Configuraci√≥n Principal

```php
return [
    // Configuraci√≥n de m√≥dulos
    'modules' => [
        // Cada m√≥dulo con sus permisos y configuraci√≥n de men√∫
    ],
    
    // Configuraci√≥n de base de datos
    'database' => [
        'connection' => 'tenant',
        'table_prefix' => 'pms_',
    ],
    
    // Integraci√≥n con Auth Package
    'auth_integration' => [
        'module_slug' => 'pms_hotel',
        'module_name' => 'PMS Hotel',
        'auto_register_permissions' => true,
        'auto_register_menus' => true,
    ],
];
```

## üìñ Uso

### Registro del Service Provider

El paquete se registra autom√°ticamente gracias a Laravel's Package Auto-Discovery. Si necesitas registrarlo manualmente:

```php
// config/app.php
'providers' => [
    // ...
    Kaely\PmsHotel\PmsHotelServiceProvider::class,
],
```

### Middleware y Rutas

Todas las rutas est√°n protegidas con middleware `auth:sanctum` y tienen el prefijo `api/pms`.

## üè® M√≥dulos Disponibles

El paquete incluye 16 m√≥dulos principales:

| M√≥dulo | Descripci√≥n | Icono |
|--------|-------------|-------|
| **Room Rate Rules** | Gesti√≥n de reglas de tarifas de habitaciones | üõèÔ∏è |
| **Foods** | Gesti√≥n de alimentos | üçΩÔ∏è |
| **Food Types** | Tipos de alimentos | üìã |
| **Dishes** | Gesti√≥n de platillos | üìñ |
| **Departments** | Departamentos del hotel | üè¢ |
| **Decorations** | Decoraciones y ambientaci√≥n | üé® |
| **Events** | Eventos especiales | üìÖ |
| **Restaurants** | Gesti√≥n de restaurantes | üè™ |
| **Desserts** | Postres | üç® |
| **Beverages** | Bebidas | üç∏ |
| **Room Changes** | Cambios de habitaci√≥n | üîÑ |
| **Special Requirements** | Requerimientos especiales | ‚≠ê |
| **Restaurant Availability** | Disponibilidad de restaurantes | üïê |
| **Restaurant Reservations** | Reservas de restaurante | ‚úÖ |
| **Reservations** | Reservas generales | üìë |
| **Courtesy Dinners** | Cenas de cortes√≠a | üéÅ |

Cada m√≥dulo incluye permisos para: `view`, `create`, `edit`, `delete`, `export`, `import`.

## üîå API Endpoints

Todos los endpoints est√°n prefijados con `/api/pms` y requieren autenticaci√≥n con Laravel Sanctum.

### Headers Requeridos

```http
Authorization: Bearer {token}
Content-Type: application/json
Accept: application/json
```

### Par√°metros de Consulta Comunes

Todos los endpoints de listado soportan los siguientes par√°metros:

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|----------|
| `search` | string | B√∫squeda en campos principales | `?search=hotel` |
| `sort_by` | string | Campo para ordenar | `?sort_by=created_at` |
| `sort_direction` | string | Direcci√≥n del orden (asc/desc) | `?sort_direction=desc` |
| `per_page` | integer | Elementos por p√°gina (m√°x: 100) | `?per_page=25` |
| `page` | integer | N√∫mero de p√°gina | `?page=2` |

### Estructura de Respuestas

#### Respuesta de Listado (Paginada)
```json
{
  "data": [...],
  "current_page": 1,
  "per_page": 15,
  "total": 100,
  "last_page": 7,
  "from": 1,
  "to": 15,
  "links": {...}
}
```

#### Respuesta de √âxito
```json
{
  "message": "Operaci√≥n exitosa",
  "data": {...}
}
```

#### Respuesta de Error
```json
{
  "message": "Error de validaci√≥n",
  "errors": {
    "field": ["Error espec√≠fico"]
  }
}
```

---

## üìã Documentaci√≥n Completa de Endpoints

### 1. üõèÔ∏è Room Rate Rules

**Base URL:** `/api/pms/room-rate-rules`

#### GET `/api/pms/room-rate-rules`
Listar todas las reglas de tarifas

**Par√°metros adicionales:**
- Ninguno espec√≠fico

**Respuesta:**
```json
{
  "data": [
    {
      "id": 1,
      "code": "STD001",
      "class": "Standard",
      "room_type_name": "Habitaci√≥n Est√°ndar",
      "min_nights": 2,
      "max_guests": 4,
      "included_dinners": 2,
      "rule_text": "Regla especial para temporada alta",
      "is_active": true,
      "created_at": "2024-01-01T00:00:00.000000Z",
      "updated_at": "2024-01-01T00:00:00.000000Z"
    }
  ]
}
```

#### POST `/api/pms/room-rate-rules`
Crear nueva regla de tarifa

**Par√°metros del cuerpo:**
```json
{
  "code": "string (requerido, m√°x: 50, √∫nico)",
  "class": "string (requerido, m√°x: 100)",
  "room_type_name": "string (requerido, m√°x: 100)",
  "min_nights": "integer (requerido, min: 1, m√°x: 365)",
  "max_guests": "integer (requerido, min: 1, m√°x: 50)",
  "included_dinners": "integer (opcional, min: 0, m√°x: 10)",
  "rule_text": "string (opcional, m√°x: 1000)",
  "is_active": "boolean (opcional, default: true)"
}
```

#### GET `/api/pms/room-rate-rules/{id}`
Obtener regla espec√≠fica

#### PUT `/api/pms/room-rate-rules/{id}`
Actualizar regla existente

**Par√°metros:** Mismos que POST pero todos opcionales

#### DELETE `/api/pms/room-rate-rules/{id}`
Eliminar regla

#### GET `/api/pms/room-rate-rules/classes`
Obtener lista de clases disponibles

#### GET `/api/pms/room-rate-rules/export`
Exportar reglas a CSV

#### POST `/api/pms/room-rate-rules/import`
Importar reglas desde archivo

**Par√°metros:**
```json
{
  "file": "file (requerido, tipos: csv,xlsx,xls, m√°x: 2MB)"
}
```

---

### 2. üìã Reservations

**Base URL:** `/api/pms/reservations`

#### GET `/api/pms/reservations`
Listar todas las reservas

**Respuesta:**
```json
{
  "data": [
    {
      "id": 1,
      "confirmation_number": "RES001",
      "guest_name": "Juan P√©rez",
      "guest_email": "juan@email.com",
      "guest_phone": "+1234567890",
      "room_number": "101",
      "room_type": "Standard",
      "check_in_date": "2024-12-25",
      "check_out_date": "2024-12-28",
      "adults": 2,
      "children": 1,
      "total_amount": "299.99",
      "status": "confirmed",
      "special_requests": "Cama extra para ni√±o",
      "created_at": "2024-01-01T00:00:00.000000Z",
      "updated_at": "2024-01-01T00:00:00.000000Z"
    }
  ]
}
```

#### POST `/api/pms/reservations`
Crear nueva reserva

**Par√°metros del cuerpo:**
```json
{
  "confirmation_number": "string (requerido, m√°x: 50, √∫nico)",
  "guest_name": "string (requerido, m√°x: 255)",
  "guest_email": "email (requerido, m√°x: 255)",
  "guest_phone": "string (opcional, m√°x: 20)",
  "room_number": "string (requerido, m√°x: 50)",
  "room_type": "string (requerido, m√°x: 100)",
  "check_in_date": "date (requerido, >= hoy)",
  "check_out_date": "date (requerido, > check_in_date)",
  "adults": "integer (requerido, min: 1, m√°x: 10)",
  "children": "integer (opcional, min: 0, m√°x: 10)",
  "total_amount": "decimal (requerido, min: 0)",
  "status": "enum (requerido: pending,confirmed,checked_in,checked_out,cancelled)",
  "special_requests": "string (opcional, m√°x: 2000)"
}
```

---

### 3. üçΩÔ∏è Restaurant Reservations

**Base URL:** `/api/pms/restaurant-reservations`

#### GET `/api/pms/restaurant-reservations`
Listar reservas de restaurante

**Respuesta:**
```json
{
  "data": [
    {
      "id": 1,
      "reservation_id": 1,
      "restaurant_id": 1,
      "event_id": 2,
      "food_id": 3,
      "dessert_id": 1,
      "beverage_id": 2,
      "decoration_id": 1,
      "special_requirement_id": 1,
      "availability_id": 1,
      "people": 4,
      "reservation_date": "2024-12-25",
      "reservation_time": "19:30",
      "status": "confirmed",
      "comment": "Mesa junto a la ventana",
      "other": "Celebraci√≥n de aniversario",
      "created_at": "2024-01-01T00:00:00.000000Z",
      "updated_at": "2024-01-01T00:00:00.000000Z"
    }
  ]
}
```

#### POST `/api/pms/restaurant-reservations`
Crear reserva de restaurante

**Par√°metros del cuerpo:**
```json
{
  "reservation_id": "integer (requerido, existe en pms_reservations)",
  "restaurant_id": "integer (requerido, existe en pms_restaurants)",
  "event_id": "integer (opcional, existe en pms_events)",
  "food_id": "integer (opcional, existe en pms_foods)",
  "dessert_id": "integer (opcional, existe en pms_desserts)",
  "beverage_id": "integer (opcional, existe en pms_beverages)",
  "decoration_id": "integer (opcional, existe en pms_decorations)",
  "special_requirement_id": "integer (opcional, existe en pms_special_requirements)",
  "availability_id": "integer (opcional, existe en pms_restaurant_availabilities)",
  "people": "integer (requerido, min: 1, m√°x: 999)",
  "reservation_date": "date (requerido, >= hoy)",
  "reservation_time": "time (requerido, formato: HH:MM)",
  "status": "enum (requerido: pending,confirmed,cancelled,completed)",
  "comment": "string (opcional, m√°x: 1000)",
  "other": "string (opcional, m√°x: 500)"
}
```

---

### 4. üè™ Restaurants

**Base URL:** `/api/pms/restaurants`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 5. üçΩÔ∏è Foods

**Base URL:** `/api/pms/foods`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 6. üìã Food Types

**Base URL:** `/api/pms/food-types`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 7. üìñ Dishes

**Base URL:** `/api/pms/dishes`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 8. üè¢ Departments

**Base URL:** `/api/pms/departments`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 9. üé® Decorations

**Base URL:** `/api/pms/decorations`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 10. üìÖ Events

**Base URL:** `/api/pms/events`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 11. üç® Desserts

**Base URL:** `/api/pms/desserts`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 12. üç∏ Beverages

**Base URL:** `/api/pms/beverages`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 13. üîÑ Room Changes

**Base URL:** `/api/pms/room-changes`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 14. ‚≠ê Special Requirements

**Base URL:** `/api/pms/special-requirements`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 15. üïê Restaurant Availability

**Base URL:** `/api/pms/restaurant-availability`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

### 16. üéÅ Courtesy Dinners

**Base URL:** `/api/pms/courtesy-dinners`

#### Estructura est√°ndar CRUD
Todos los endpoints siguen el patr√≥n RESTful est√°ndar.

---

## üîç C√≥digos de Estado HTTP

| C√≥digo | Descripci√≥n |
|--------|-------------|
| 200 | OK - Operaci√≥n exitosa |
| 201 | Created - Recurso creado exitosamente |
| 400 | Bad Request - Error en los par√°metros |
| 401 | Unauthorized - Token de autenticaci√≥n inv√°lido |
| 403 | Forbidden - Sin permisos para la operaci√≥n |
| 404 | Not Found - Recurso no encontrado |
| 422 | Unprocessable Entity - Error de validaci√≥n |
| 500 | Internal Server Error - Error del servidor |

## üîê Autenticaci√≥n y Permisos

Cada endpoint requiere permisos espec√≠ficos:

- **view**: Para endpoints GET de listado y detalle
- **create**: Para endpoints POST
- **edit**: Para endpoints PUT/PATCH
- **delete**: Para endpoints DELETE
- **export**: Para endpoints de exportaci√≥n
- **import**: Para endpoints de importaci√≥n

Los permisos siguen el formato: `{module}.{action}` (ej: `reservations.view`, `restaurants.create`)

## üõ†Ô∏è Comandos Artisan

### Instalaci√≥n
```bash
php artisan pms-hotel:install
```
Instala el paquete completo, publica configuraciones, migraciones y seeders.

### Seeders
```bash
php artisan pms-hotel:seed
```
Ejecuta los seeders para poblar la base de datos con datos de ejemplo.

### Generaci√≥n de M√≥dulos
```bash
php artisan pms-hotel:generate-modules
```
Genera autom√°ticamente la estructura de m√≥dulos basada en la configuraci√≥n.

## üìä Modelos

Todos los modelos extienden de `BaseModel` que proporciona:

- **Conexi√≥n Multi-tenant**: Usa la conexi√≥n `tenant`
- **Prefijo de Tablas**: Autom√°tico basado en configuraci√≥n
- **User Tracking**: Seguimiento de usuarios que crean/modifican registros
- **Soft Deletes**: Eliminaci√≥n suave de registros
- **Scopes**: Scope `active()` para registros activos

### Modelos Principales

- `RoomRateRule` - Reglas de tarifas de habitaciones
- `Reservation` - Reservas generales
- `Restaurant` - Restaurantes
- `RestaurantReservation` - Reservas de restaurante
- `Food`, `FoodType`, `Dish` - Gesti√≥n de alimentos
- `Event` - Eventos especiales
- `Department` - Departamentos
- `Decoration` - Decoraciones
- `Beverage`, `Dessert` - Bebidas y postres
- `RoomChange` - Cambios de habitaci√≥n
- `SpecialRequirement` - Requerimientos especiales
- `RestaurantAvailability` - Disponibilidad de restaurantes
- `CourtesyDinner` - Cenas de cortes√≠a

## üîê Pol√≠ticas de Autorizaci√≥n

El paquete incluye pol√≠ticas de autorizaci√≥n para cada modelo principal:

- `RoomRateRulePolicy`
- `FoodPolicy`
- `FoodTypePolicy`
- `DishPolicy`
- `RestaurantPolicy`
- `RestaurantReservationPolicy`

Las pol√≠ticas se registran autom√°ticamente en el `PmsHotelServiceProvider`.

## üóÑÔ∏è Configuraci√≥n de Base de Datos

### Conexi√≥n Multi-tenant

El paquete est√° configurado para usar la conexi√≥n `tenant` por defecto:

```php
'database' => [
    'connection' => 'tenant',
    'table_prefix' => 'pms_',
],
```

### Prefijo de Tablas

Todas las tablas usan el prefijo `pms_` por defecto. Esto se puede cambiar en la configuraci√≥n.

### Migraciones

Las migraciones se publican en `database/migrations` y crean todas las tablas necesarias para el funcionamiento del sistema.

## üîó Integraci√≥n con Auth Package

El paquete se integra autom√°ticamente con `kaelytechnology/auth-package`:

```php
'auth_integration' => [
    'module_slug' => 'pms_hotel',
    'module_name' => 'PMS Hotel',
    'auto_register_permissions' => true,
    'auto_register_menus' => true,
],
```

- **Registro Autom√°tico de Permisos**: Todos los permisos se registran autom√°ticamente
- **Men√∫s Autom√°ticos**: Los men√∫s se generan basados en la configuraci√≥n de m√≥dulos
- **Control de Acceso**: Integraci√≥n completa con el sistema de roles y permisos

## üß™ Testing

```bash
# Ejecutar tests
vendor/bin/phpunit

# Ejecutar tests con coverage
vendor/bin/phpunit --coverage-html coverage
```

## ü§ù Contribuir

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìù Changelog

Ver [CHANGELOG.md](CHANGELOG.md) para una lista de cambios.

## üîí Seguridad

Si descubres alguna vulnerabilidad de seguridad, por favor env√≠a un email a info@kaelytechnology.com.

## üìÑ Licencia

Este proyecto est√° licenciado bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

## üë• Autores

- **Kaely Technology** - *Desarrollo inicial* - [Kaely Technology](https://github.com/kaelytechnology)

## üôè Agradecimientos

- Laravel Framework
- Comunidad de desarrolladores PHP
- Todos los contribuidores del proyecto

---

**Desarrollado con ‚ù§Ô∏è por [Kaely Technology](https://kaelytechnology.com)**